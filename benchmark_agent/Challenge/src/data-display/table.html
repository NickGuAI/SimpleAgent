<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUI Table Challenge</title>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Material UI -->
    <script src="https://unpkg.com/@mui/material@5.14.0/umd/material-ui.production.min.js"></script>
    
    <!-- Material UI Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    <!-- Roboto Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: rgba(0, 0, 0, 0.87);
            line-height: 1.5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2);
            padding: 24px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        .header h1 {
            color: #1976d2;
            font-weight: 400;
            margin-bottom: 8px;
        }
        
        .header p {
            color: rgba(0, 0, 0, 0.6);
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 32px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #1976d2;
        }
        
        .test-description {
            color: rgba(0, 0, 0, 0.6);
            margin-bottom: 16px;
        }
        
        .test-area {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        .result-area {
            margin-top: 16px;
            padding: 16px;
            background-color: #e3f2fd;
            border-radius: 4px;
            display: none;
        }
        
        .result-area.success {
            background-color: #e8f5e9;
            display: block;
        }
        
        .result-area.error {
            background-color: #ffebee;
            display: block;
        }
        
        .result-message {
            font-weight: 500;
        }
        
        .success .result-message {
            color: #2e7d32;
        }
        
        .error .result-message {
            color: #c62828;
        }
        
        .test-controls {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(0, 0, 0, 0.12);
        }
        
        .test-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 500;
            background-color: #e0e0e0;
            color: rgba(0, 0, 0, 0.6);
        }
        
        .test-status.pass {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        
        .test-status.fail {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .selected-info {
            margin-top: 16px;
            padding: 12px;
            background-color: #e3f2fd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .table-controls {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MUI Component Challenge: Table</h1>
            <p>Test the functionality and behavior of the Material UI Table component</p>
        </div>
        
        <div id="app"></div>
    </div>
    
    <script type="text/babel">
        const { 
            Table,
            TableBody,
            TableCell,
            TableContainer,
            TableHead,
            TableRow,
            TablePagination,
            TableSortLabel,
            Paper,
            Checkbox,
            IconButton,
            Toolbar,
            Typography,
            Box,
            Icon,
            Tooltip,
            FormControlLabel,
            Switch,
            Button
        } = window['MaterialUI'];
        
        // Sample data
        function createData(id, name, calories, fat, carbs, protein) {
            return { id, name, calories, fat, carbs, protein };
        }
        
        const rows = [
            createData(1, 'Frozen yoghurt', 159, 6.0, 24, 4.0),
            createData(2, 'Ice cream sandwich', 237, 9.0, 37, 4.3),
            createData(3, 'Eclair', 262, 16.0, 24, 6.0),
            createData(4, 'Cupcake', 305, 3.7, 67, 4.3),
            createData(5, 'Gingerbread', 356, 16.0, 49, 3.9),
        ];
        
        // Test harness for component challenges
        const TestHarness = ({ children, testId, testName, description, onComplete }) => {
            const [status, setStatus] = React.useState('pending');
            const [message, setMessage] = React.useState('');
            
            const completeTest = (success, msg) => {
                setStatus(success ? 'pass' : 'fail');
                setMessage(msg);
                if (onComplete) {
                    onComplete(testId, success);
                }
            };
            
            return (
                <div className="test-section">
                    <h2 className="test-title">{testName}</h2>
                    <p className="test-description">{description}</p>
                    <div className="test-area">
                        {React.cloneElement(children, { completeTest })}
                    </div>
                    <div className={`result-area ${status === 'pass' ? 'success' : status === 'fail' ? 'error' : ''}`}>
                        <p className="result-message">{message}</p>
                    </div>
                    <div className="test-controls">
                        <span className={`test-status ${status}`}>
                            {status === 'pending' ? 'Pending' : status === 'pass' ? 'Passed' : 'Failed'}
                        </span>
                    </div>
                </div>
            );
        };
        
        // Test 1: Basic Table Click
        const BasicTableTest = ({ completeTest }) => {
            const [clickedRows, setClickedRows] = React.useState(new Set());
            
            const handleRowClick = (id) => {
                const newClicked = new Set(clickedRows);
                newClicked.add(id);
                setClickedRows(newClicked);
                
                if (newClicked.size === rows.length) {
                    completeTest(true, 'All table rows clicked successfully!');
                }
            };
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Click on each row in the table:
                    </Typography>
                    <TableContainer component={Paper}>
                        <Table sx={{ minWidth: 650 }} aria-label="simple table">
                            <TableHead>
                                <TableRow>
                                    <TableCell>Dessert (100g serving)</TableCell>
                                    <TableCell align="right">Calories</TableCell>
                                    <TableCell align="right">Fat&nbsp;(g)</TableCell>
                                    <TableCell align="right">Carbs&nbsp;(g)</TableCell>
                                    <TableCell align="right">Protein&nbsp;(g)</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {rows.map((row) => (
                                    <TableRow
                                        key={row.id}
                                        id={`row-${row.id}`}
                                        onClick={() => handleRowClick(row.id)}
                                        sx={{ 
                                            '&:hover': { backgroundColor: 'action.hover' },
                                            cursor: 'pointer',
                                            backgroundColor: clickedRows.has(row.id) ? 'action.selected' : 'inherit'
                                        }}
                                    >
                                        <TableCell component="th" scope="row">
                                            {row.name}
                                        </TableCell>
                                        <TableCell align="right">{row.calories}</TableCell>
                                        <TableCell align="right">{row.fat}</TableCell>
                                        <TableCell align="right">{row.carbs}</TableCell>
                                        <TableCell align="right">{row.protein}</TableCell>
                                    </TableRow>
                                ))}
                            </TableBody>
                        </Table>
                    </TableContainer>
                    <Typography variant="caption" sx={{ mt: 1, display: 'block' }}>
                        Clicked rows: {clickedRows.size}/{rows.length}
                    </Typography>
                </Box>
            );
        };
        
        // Test 2: Table with Selection
        const SelectableTableTest = ({ completeTest }) => {
            const [selected, setSelected] = React.useState([]);
            
            const handleSelectAllClick = (event) => {
                if (event.target.checked) {
                    const newSelected = rows.map((n) => n.id);
                    setSelected(newSelected);
                    completeTest(true, 'All rows selected successfully!');
                    return;
                }
                setSelected([]);
            };
            
            const handleClick = (event, id) => {
                const selectedIndex = selected.indexOf(id);
                let newSelected = [];
                
                if (selectedIndex === -1) {
                    newSelected = newSelected.concat(selected, id);
                } else if (selectedIndex === 0) {
                    newSelected = newSelected.concat(selected.slice(1));
                } else if (selectedIndex === selected.length - 1) {
                    newSelected = newSelected.concat(selected.slice(0, -1));
                } else if (selectedIndex > 0) {
                    newSelected = newSelected.concat(
                        selected.slice(0, selectedIndex),
                        selected.slice(selectedIndex + 1),
                    );
                }
                
                setSelected(newSelected);
            };
            
            const isSelected = (id) => selected.indexOf(id) !== -1;
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Select all rows using the checkbox in the header:
                    </Typography>
                    <TableContainer component={Paper}>
                        <Table sx={{ minWidth: 650 }} aria-label="selectable table">
                            <TableHead>
                                <TableRow>
                                    <TableCell padding="checkbox">
                                        <Checkbox
                                            id="select-all-checkbox"
                                            color="primary"
                                            indeterminate={selected.length > 0 && selected.length < rows.length}
                                            checked={rows.length > 0 && selected.length === rows.length}
                                            onChange={handleSelectAllClick}
                                        />
                                    </TableCell>
                                    <TableCell>Dessert</TableCell>
                                    <TableCell align="right">Calories</TableCell>
                                    <TableCell align="right">Fat&nbsp;(g)</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {rows.map((row) => {
                                    const isItemSelected = isSelected(row.id);
                                    
                                    return (
                                        <TableRow
                                            key={row.id}
                                            id={`selectable-row-${row.id}`}
                                            hover
                                            onClick={(event) => handleClick(event, row.id)}
                                            role="checkbox"
                                            aria-checked={isItemSelected}
                                            tabIndex={-1}
                                            selected={isItemSelected}
                                            sx={{ cursor: 'pointer' }}
                                        >
                                            <TableCell padding="checkbox">
                                                <Checkbox
                                                    color="primary"
                                                    checked={isItemSelected}
                                                />
                                            </TableCell>
                                            <TableCell component="th" scope="row">
                                                {row.name}
                                            </TableCell>
                                            <TableCell align="right">{row.calories}</TableCell>
                                            <TableCell align="right">{row.fat}</TableCell>
                                        </TableRow>
                                    );
                                })}
                            </TableBody>
                        </Table>
                    </TableContainer>
                    {selected.length > 0 && (
                        <div className="selected-info">
                            {selected.length} row{selected.length > 1 ? 's' : ''} selected
                        </div>
                    )}
                </Box>
            );
        };
        
        // Test 3: Sortable Table
        const SortableTableTest = ({ completeTest }) => {
            const [order, setOrder] = React.useState('asc');
            const [orderBy, setOrderBy] = React.useState('calories');
            const [sortedColumns, setSortedColumns] = React.useState(new Set());
            
            const handleRequestSort = (property) => {
                const isAsc = orderBy === property && order === 'asc';
                setOrder(isAsc ? 'desc' : 'asc');
                setOrderBy(property);
                
                const newSorted = new Set(sortedColumns);
                newSorted.add(property);
                setSortedColumns(newSorted);
                
                if (newSorted.size >= 3) {
                    completeTest(true, 'Multiple columns sorted successfully!');
                }
            };
            
            const sortedRows = React.useMemo(() => {
                return [...rows].sort((a, b) => {
                    if (order === 'desc') {
                        return b[orderBy] > a[orderBy] ? 1 : -1;
                    }
                    return a[orderBy] > b[orderBy] ? 1 : -1;
                });
            }, [order, orderBy]);
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Click on at least 3 different column headers to sort:
                    </Typography>
                    <TableContainer component={Paper}>
                        <Table sx={{ minWidth: 650 }} aria-label="sortable table">
                            <TableHead>
                                <TableRow>
                                    <TableCell>
                                        <TableSortLabel
                                            id="sort-name"
                                            active={orderBy === 'name'}
                                            direction={orderBy === 'name' ? order : 'asc'}
                                            onClick={() => handleRequestSort('name')}
                                        >
                                            Dessert
                                        </TableSortLabel>
                                    </TableCell>
                                    <TableCell align="right">
                                        <TableSortLabel
                                            id="sort-calories"
                                            active={orderBy === 'calories'}
                                            direction={orderBy === 'calories' ? order : 'asc'}
                                            onClick={() => handleRequestSort('calories')}
                                        >
                                            Calories
                                        </TableSortLabel>
                                    </TableCell>
                                    <TableCell align="right">
                                        <TableSortLabel
                                            id="sort-fat"
                                            active={orderBy === 'fat'}
                                            direction={orderBy === 'fat' ? order : 'asc'}
                                            onClick={() => handleRequestSort('fat')}
                                        >
                                            Fat&nbsp;(g)
                                        </TableSortLabel>
                                    </TableCell>
                                    <TableCell align="right">
                                        <TableSortLabel
                                            id="sort-protein"
                                            active={orderBy === 'protein'}
                                            direction={orderBy === 'protein' ? order : 'asc'}
                                            onClick={() => handleRequestSort('protein')}
                                        >
                                            Protein&nbsp;(g)
                                        </TableSortLabel>
                                    </TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {sortedRows.map((row) => (
                                    <TableRow key={row.id}>
                                        <TableCell component="th" scope="row">
                                            {row.name}
                                        </TableCell>
                                        <TableCell align="right">{row.calories}</TableCell>
                                        <TableCell align="right">{row.fat}</TableCell>
                                        <TableCell align="right">{row.protein}</TableCell>
                                    </TableRow>
                                ))}
                            </TableBody>
                        </Table>
                    </TableContainer>
                    <Typography variant="caption" sx={{ mt: 1, display: 'block' }}>
                        Sorted by: {orderBy} ({order}) | Columns sorted: {sortedColumns.size}
                    </Typography>
                </Box>
            );
        };
        
        // Test 4: Table with Pagination
        const PaginatedTableTest = ({ completeTest }) => {
            const [page, setPage] = React.useState(0);
            const [rowsPerPage, setRowsPerPage] = React.useState(2);
            const [visitedPages, setVisitedPages] = React.useState(new Set([0]));
            
            const handleChangePage = (event, newPage) => {
                setPage(newPage);
                const newVisited = new Set(visitedPages);
                newVisited.add(newPage);
                setVisitedPages(newVisited);
                
                const totalPages = Math.ceil(rows.length / rowsPerPage);
                if (newVisited.size === totalPages) {
                    completeTest(true, 'All pages visited successfully!');
                }
            };
            
            const handleChangeRowsPerPage = (event) => {
                setRowsPerPage(parseInt(event.target.value, 10));
                setPage(0);
                setVisitedPages(new Set([0]));
            };
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Navigate through all pages using the pagination controls:
                    </Typography>
                    <TableContainer component={Paper}>
                        <Table sx={{ minWidth: 650 }} aria-label="paginated table">
                            <TableHead>
                                <TableRow>
                                    <TableCell>Dessert</TableCell>
                                    <TableCell align="right">Calories</TableCell>
                                    <TableCell align="right">Fat&nbsp;(g)</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {rows
                                    .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)
                                    .map((row) => (
                                        <TableRow key={row.id}>
                                            <TableCell component="th" scope="row">
                                                {row.name}
                                            </TableCell>
                                            <TableCell align="right">{row.calories}</TableCell>
                                            <TableCell align="right">{row.fat}</TableCell>
                                        </TableRow>
                                    ))}
                            </TableBody>
                        </Table>
                        <TablePagination
                            id="table-pagination"
                            rowsPerPageOptions={[2, 3, 5]}
                            component="div"
                            count={rows.length}
                            rowsPerPage={rowsPerPage}
                            page={page}
                            onPageChange={handleChangePage}
                            onRowsPerPageChange={handleChangeRowsPerPage}
                        />
                    </TableContainer>
                    <Typography variant="caption" sx={{ mt: 1, display: 'block' }}>
                        Pages visited: {visitedPages.size}/{Math.ceil(rows.length / rowsPerPage)}
                    </Typography>
                </Box>
            );
        };
        
        // Test 5: Dense Table
        const DenseTableTest = ({ completeTest }) => {
            const [dense, setDense] = React.useState(false);
            const [clickedInBothModes, setClickedInBothModes] = React.useState({
                normal: false,
                dense: false
            });
            
            const handleDenseChange = () => {
                setDense(!dense);
            };
            
            const handleTableClick = () => {
                const mode = dense ? 'dense' : 'normal';
                setClickedInBothModes(prev => ({
                    ...prev,
                    [mode]: true
                }));
                
                if (!dense && clickedInBothModes.dense) {
                    completeTest(true, 'Table tested in both normal and dense modes!');
                } else if (dense && clickedInBothModes.normal) {
                    completeTest(true, 'Table tested in both normal and dense modes!');
                }
            };
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Click the table in both normal and dense modes:
                    </Typography>
                    <div className="table-controls">
                        <FormControlLabel
                            control={
                                <Switch
                                    id="dense-toggle"
                                    checked={dense}
                                    onChange={handleDenseChange}
                                />
                            }
                            label="Dense padding"
                        />
                    </div>
                    <TableContainer component={Paper}>
                        <Table
                            sx={{ minWidth: 650 }}
                            aria-label="dense table"
                            size={dense ? 'small' : 'medium'}
                            onClick={handleTableClick}
                        >
                            <TableHead>
                                <TableRow>
                                    <TableCell>Dessert</TableCell>
                                    <TableCell align="right">Calories</TableCell>
                                    <TableCell align="right">Fat&nbsp;(g)</TableCell>
                                    <TableCell align="right">Carbs&nbsp;(g)</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {rows.slice(0, 3).map((row) => (
                                    <TableRow 
                                        key={row.id}
                                        sx={{ cursor: 'pointer' }}
                                        hover
                                    >
                                        <TableCell component="th" scope="row">
                                            {row.name}
                                        </TableCell>
                                        <TableCell align="right">{row.calories}</TableCell>
                                        <TableCell align="right">{row.fat}</TableCell>
                                        <TableCell align="right">{row.carbs}</TableCell>
                                    </TableRow>
                                ))}
                            </TableBody>
                        </Table>
                    </TableContainer>
                    <Typography variant="caption" sx={{ mt: 1, display: 'block' }}>
                        Normal mode: {clickedInBothModes.normal ? '✓' : '✗'} | 
                        Dense mode: {clickedInBothModes.dense ? '✓' : '✗'}
                    </Typography>
                </Box>
            );
        };
        
        // Test 6: Table with Actions
        const ActionsTableTest = ({ completeTest }) => {
            const [editedRows, setEditedRows] = React.useState(new Set());
            const [deletedRows, setDeletedRows] = React.useState(new Set());
            
            const handleEdit = (id) => {
                const newEdited = new Set(editedRows);
                newEdited.add(id);
                setEditedRows(newEdited);
                checkCompletion(newEdited, deletedRows);
            };
            
            const handleDelete = (id) => {
                const newDeleted = new Set(deletedRows);
                newDeleted.add(id);
                setDeletedRows(newDeleted);
                checkCompletion(editedRows, newDeleted);
            };
            
            const checkCompletion = (edited, deleted) => {
                if (edited.size >= 2 && deleted.size >= 2) {
                    completeTest(true, 'Multiple rows edited and deleted successfully!');
                }
            };
            
            return (
                <Box>
                    <Typography variant="body2" gutterBottom>
                        Edit at least 2 rows and delete at least 2 rows:
                    </Typography>
                    <TableContainer component={Paper}>
                        <Table sx={{ minWidth: 650 }} aria-label="actions table">
                            <TableHead>
                                <TableRow>
                                    <TableCell>Dessert</TableCell>
                                    <TableCell align="right">Calories</TableCell>
                                    <TableCell align="right">Actions</TableCell>
                                </TableRow>
                            </TableHead>
                            <TableBody>
                                {rows.map((row) => (
                                    !deletedRows.has(row.id) && (
                                        <TableRow key={row.id}>
                                            <TableCell component="th" scope="row">
                                                {row.name} {editedRows.has(row.id) && '(edited)'}
                                            </TableCell>
                                            <TableCell align="right">{row.calories}</TableCell>
                                            <TableCell align="right">
                                                <Tooltip title="Edit">
                                                    <IconButton
                                                        id={`edit-${row.id}`}
                                                        size="small"
                                                        onClick={() => handleEdit(row.id)}
                                                        disabled={editedRows.has(row.id)}
                                                    >
                                                        <Icon>edit</Icon>
                                                    </IconButton>
                                                </Tooltip>
                                                <Tooltip title="Delete">
                                                    <IconButton
                                                        id={`delete-${row.id}`}
                                                        size="small"
                                                        onClick={() => handleDelete(row.id)}
                                                        color="error"
                                                    >
                                                        <Icon>delete</Icon>
                                                    </IconButton>
                                                </Tooltip>
                                            </TableCell>
                                        </TableRow>
                                    )
                                ))}
                            </TableBody>
                        </Table>
                    </TableContainer>
                    <Typography variant="caption" sx={{ mt: 1, display: 'block' }}>
                        Edited: {editedRows.size} | Deleted: {deletedRows.size}
                    </Typography>
                </Box>
            );
        };
        
        // Main App component
        const App = () => {
            const [testResults, setTestResults] = React.useState({});
            
            const handleTestComplete = (testId, success) => {
                setTestResults(prev => ({
                    ...prev,
                    [testId]: success
                }));
                
                // Check if this was triggered by browser automation
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'challengeComplete',
                        challenge: 'table',
                        testId: testId,
                        success: success
                    }, '*');
                }
            };
            
            return (
                <>
                    <TestHarness
                        testId="basic-table"
                        testName="Test 1: Basic Table Interaction"
                        description="Click on each row in the table"
                        onComplete={handleTestComplete}
                    >
                        <BasicTableTest />
                    </TestHarness>
                    
                    <TestHarness
                        testId="selectable-table"
                        testName="Test 2: Table with Selection"
                        description="Select all rows using the header checkbox"
                        onComplete={handleTestComplete}
                    >
                        <SelectableTableTest />
                    </TestHarness>
                    
                    <TestHarness
                        testId="sortable-table"
                        testName="Test 3: Sortable Table"
                        description="Sort the table by different columns"
                        onComplete={handleTestComplete}
                    >
                        <SortableTableTest />
                    </TestHarness>
                    
                    <TestHarness
                        testId="paginated-table"
                        testName="Test 4: Table with Pagination"
                        description="Navigate through all pages of the table"
                        onComplete={handleTestComplete}
                    >
                        <PaginatedTableTest />
                    </TestHarness>
                    
                    <TestHarness
                        testId="dense-table"
                        testName="Test 5: Dense Table"
                        description="Test table in both normal and dense padding modes"
                        onComplete={handleTestComplete}
                    >
                        <DenseTableTest />
                    </TestHarness>
                    
                    <TestHarness
                        testId="actions-table"
                        testName="Test 6: Table with Actions"
                        description="Edit and delete rows using action buttons"
                        onComplete={handleTestComplete}
                    >
                        <ActionsTableTest />
                    </TestHarness>
                </>
            );
        };
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<App />);
    </script>
</body>
</html>